<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Movie Browser — Single Page</title>
  <style>
    :root{
      --bg: #0b1020;
      --card: #0f1724;
      --muted: #9aa4b2;
      --accent: #6ee7b7;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#061025 0%,#071827 100%);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    .app { max-width:1200px;margin:28px auto;padding:20px; color:#e6eef6; }
    header{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    .search { background:var(--glass);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:12px;color:inherit;min-width:200px}
    .btn { background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;cursor:pointer;color:inherit;font-weight:600 }
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);cursor:pointer;transition:transform .18s ease, box-shadow .18s ease;}
    .card:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    .poster {width:100%;height:240px;object-fit:cover;background:#021024;display:block}
    .meta{padding:10px}
    .title{font-size:14px;font-weight:700;line-height:1.1;margin-bottom:6px}
    .sub{font-size:12px;color:var(--muted)}
    .load-more{display:block;margin:18px auto;padding:10px 16px;border-radius:10px;background:linear-gradient(90deg,#0f1724,#0b1220);border:1px solid rgba(255,255,255,0.03);color:var(--accent);cursor:pointer}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(1,6,12,0.55);display:flex;align-items:center;justify-content:center;padding:18px;z-index:40}
    .modal{width:100%;max-width:980px;background:linear-gradient(180deg,#071827,#061521);border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,0.04);display:flex;gap:18px;box-shadow:0 30px 80px rgba(2,6,23,0.7)}
    .modal-left{min-width:300px;max-width:360px}
    .modal-left img{width:100%;height:100%;object-fit:cover;display:block}
    .modal-right{padding:20px;flex:1;overflow:auto;max-height:85vh}
    .close{background:transparent;border:0;color:var(--muted);cursor:pointer;font-weight:700}
    .badges{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    .badge{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,0.02)}
    .section{margin-top:10px}
    .muted{color:var(--muted);font-size:13px}
    .cast-list{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .cast-item{width:110px;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;text-align:center;font-size:13px}
    iframe{width:100%;height:320px;border:0;border-radius:8px}
    @media (max-width:720px){
      .modal{flex-direction:column}
      .modal-left{max-width:100%}
      .poster{height:200px}
    }
    .empty{padding:28px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div>
        <h1>Movie Browser — all movies</h1>
        <div class="muted">Click any tile to see full details & trailer</div>
      </div>
      <div class="controls">
        <input class="search" id="searchInput" placeholder="Search movies (press Enter)"/>
        <button class="btn" id="refreshBtn">Refresh</button>
      </div>
    </header>

    <main>
      <div id="grid" class="grid" aria-live="polite"></div>
      <button id="loadMore" class="load-more">Load more movies</button>
      <div id="empty" class="empty" style="display:none">No movies found.</div>
    </main>
  </div>

  <!-- Modal template -->
  <template id="modalTpl">
    <div class="modal-backdrop" id="modalBackdrop">
      <div class="modal" role="dialog" aria-modal="true">
        <div class="modal-left" id="modalLeft">
          <img id="modalPoster" alt="poster"/>
        </div>
        <div class="modal-right">
          <div style="display:flex;align-items:center;gap:12px">
            <h2 id="modalTitle" style="margin:0"></h2>
            <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
              <div class="muted" id="modalRating"></div>
              <button class="close" id="modalClose">✕</button>
            </div>
          </div>
          <div class="muted" id="modalSub"></div>
          <div class="badges" id="modalBadges"></div>

          <div class="section">
            <h3 style="margin:0 0 6px 0">Overview</h3>
            <div id="modalOverview" class="muted"></div>
          </div>

          <div class="section" id="trailerSection" style="display:none">
            <h3 style="margin:0 0 6px 0">Trailer</h3>
            <div id="trailerWrap"></div>
          </div>

          <div class="section" id="castSection" style="display:none">
            <h3 style="margin:0 0 6px 0">Top cast</h3>
            <div id="castList" class="cast-list"></div>
          </div>

          <div class="section">
            <h3 style="margin:0 0 6px 0">More</h3>
            <div id="moreInfo" class="muted"></div>
          </div>
        </div>
      </div>
    </div>
  </template>

  <script>
    /******************************
     * Configuration (you provided)
     ******************************/
    // Your API values (supplied by you)
    const API_KEY = "ff89d0158c28cc3afdd07409c310706a";
    const BEARER_TOKEN = "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJmZjg5ZDAxNThjMjhjYzNhZmRkMDc0MDljMzEwNzA2YSIsIm5iZiI6MTc2MDg4NzQ3Mi44MjQsInN1YiI6IjY4ZjUwMmIwNTgxZWI3OTk4NTAwZGJlNSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.T1K1nyyRdRRTVOyZx0jv-aUx_kegGTjI_55mef1XuKM";

    // TMDB base urls
    const API_BASE = "https://api.themoviedb.org/3";
    const IMG_BASE = "https://image.tmdb.org/t/p/";
    const DEFAULT_IMG = "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(
      '<svg xmlns="http://www.w3.org/2000/svg" width="600" height="900"><rect width="100%" height="100%" fill="#021024"/><text x="50%" y="50%" fill="#12314a" font-size="22" text-anchor="middle" font-family="Arial">No Image</text></svg>'
    );

    /******************************
     * App state
     ******************************/
    let currentPage = 1;
    let totalPages = 1;
    let movies = [];
    let isLoading = false;
    const grid = document.getElementById('grid');
    const loadMoreBtn = document.getElementById('loadMore');
    const emptyBox = document.getElementById('empty');
    const searchInput = document.getElementById('searchInput');
    const refreshBtn = document.getElementById('refreshBtn');

    /******************************
     * Helpers
     ******************************/
    function authHeaders() {
      // We include both bearer and api_key param when calling TMDB endpoints.
      return {
        "Authorization": "Bearer " + BEARER_TOKEN,
        "Content-Type": "application/json;charset=utf-8"
      };
    }

    function posterUrl(path, size = 'w342') {
      return path ? (IMG_BASE + size + path) : DEFAULT_IMG;
    }

    function el(tag, attrs = {}, children = []) {
      const e = document.createElement(tag);
      for (const k in attrs) {
        if (k === 'class') e.className = attrs[k];
        else if (k === 'html') e.innerHTML = attrs[k];
        else e.setAttribute(k, attrs[k]);
      }
      children.forEach(c => e.appendChild(c));
      return e;
    }

    /******************************
     * Fetching
     ******************************/
    async function tmdb(path, params = {}) {
      // helper for GET requests to TMDB
      const url = new URL(API_BASE + path);
      params.api_key = API_KEY; // include API key as query param
      Object.entries(params).forEach(([k,v]) => url.searchParams.set(k, v));
      const res = await fetch(url.toString(), { headers: authHeaders() });
      if (!res.ok) {
        const text = await res.text();
        throw new Error("TMDB request failed: " + res.status + " " + text);
      }
      return res.json();
    }

    async function fetchMovies(page = 1) {
      if (isLoading) return;
      isLoading = true;
      try {
        // We'll fetch "popular" as a broad list; you can swap to discover/search as needed
        const data = await tmdb('/movie/popular', { page });
        totalPages = data.total_pages || 1;
        currentPage = data.page || page;
        movies.push(...data.results);
        renderGrid();
      } catch (err) {
        console.error(err);
        alert("Error fetching movies: " + err.message);
      } finally {
        isLoading = false;
      }
    }

    async function searchMovies(query, page = 1) {
      if (!query) return;
      isLoading = true;
      try {
        const data = await tmdb('/search/movie', { query, page });
        movies = data.results || [];
        totalPages = data.total_pages || 1;
        currentPage = data.page || 1;
        renderGrid();
      } catch (err) {
        console.error(err);
        alert("Search failed: " + err.message);
      } finally {
        isLoading = false;
      }
    }

    async function fetchDetails(movieId) {
      // include videos and credits
      return tmdb(`/movie/${movieId}`, { append_to_response: 'videos,credits,images' });
    }

    /******************************
     * Render
     ******************************/
    function renderGrid() {
      grid.innerHTML = '';
      if (!movies || movies.length === 0) {
        emptyBox.style.display = 'block';
        loadMoreBtn.style.display = 'none';
        return;
      } else {
        emptyBox.style.display = 'none';
      }

      for (const mv of movies) {
        const card = el('div', { class: 'card', role: 'button', tabindex: 0 });
        const img = el('img', { class: 'poster', src: posterUrl(mv.poster_path), alt: mv.title });
        const meta = el('div', { class: 'meta' });
        const title = el('div', { class: 'title' }); title.textContent = mv.title;
        const sub = el('div', { class: 'sub' }); sub.textContent = `${(mv.release_date||'').slice(0,4)} • ⭐ ${mv.vote_average || '—'}`;
        meta.appendChild(title);
        meta.appendChild(sub);
        card.appendChild(img);
        card.appendChild(meta);

        card.addEventListener('click', () => openModal(mv.id));
        card.addEventListener('keydown', (e) => { if (e.key === 'Enter') openModal(mv.id); });

        grid.appendChild(card);
      }

      // load more button visibility
      if (currentPage < totalPages) {
        loadMoreBtn.style.display = 'block';
      } else {
        loadMoreBtn.style.display = 'none';
      }
    }

    /******************************
     * Modal — details
     ******************************/
    async function openModal(movieId) {
      const tpl = document.getElementById('modalTpl');
      const node = tpl.content.cloneNode(true);
      const backdrop = node.querySelector('#modalBackdrop');
      const modalClose = node.querySelector('#modalClose');
      const posterEl = node.querySelector('#modalPoster');
      const titleEl = node.querySelector('#modalTitle');
      const subEl = node.querySelector('#modalSub');
      const ratingEl = node.querySelector('#modalRating');
      const badgesEl = node.querySelector('#modalBadges');
      const overviewEl = node.querySelector('#modalOverview');
      const moreEl = node.querySelector('#moreInfo');
      const trailerSection = node.querySelector('#trailerSection');
      const trailerWrap = node.querySelector('#trailerWrap');
      const castSection = node.querySelector('#castSection');
      const castList = node.querySelector('#castList');

      document.body.appendChild(backdrop);

      // close handlers
      function close() { backdrop.remove(); document.removeEventListener('keydown', onKey); }
      modalClose.addEventListener('click', close);
      backdrop.addEventListener('click', (e) => { if (e.target === backdrop) close(); });
      function onKey(e) { if (e.key === 'Escape') close(); }
      document.addEventListener('keydown', onKey);

      // load details
      try {
        const d = await fetchDetails(movieId);
        posterEl.src = posterUrl(d.poster_path, 'w500');
        titleEl.textContent = d.title + (d.tagline ? ' — ' + d.tagline : '');
        subEl.textContent = `${d.release_date || 'Unknown'} • ${d.genres?.map(g=>g.name).join(', ') || '—'}`;
        ratingEl.textContent = `⭐ ${d.vote_average || '—'}`;
        overviewEl.textContent = d.overview || 'No overview available.';
        badgesEl.innerHTML = '';
        badgesEl.appendChild(el('div',{class:'badge'},[])).textContent = d.runtime ? d.runtime + ' min' : '—';
        if (d.status) badgesEl.appendChild(el('div',{class:'badge'},[])).textContent = d.status;

        // trailer (prefer official youtube trailer)
        const vids = (d.videos && d.videos.results) ? d.videos.results : [];
        const yt = vids.find(v => v.site === 'YouTube' && v.type === 'Trailer' && v.official) || vids.find(v => v.site === 'YouTube' && v.type === 'Trailer');
        if (yt) {
          trailerSection.style.display = 'block';
          trailerWrap.innerHTML = `<iframe src="https://www.youtube.com/embed/${yt.key}" title="Trailer" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
        } else {
          trailerSection.style.display = 'none';
        }

        // cast
        const cast = (d.credits && d.credits.cast) ? d.credits.cast.slice(0,8) : [];
        if (cast.length) {
          castSection.style.display = 'block';
          castList.innerHTML = '';
          cast.forEach(c => {
            const ci = el('div',{class:'cast-item'});
            const cimg = el('img',{src: posterUrl(c.profile_path,'w154'), alt: c.name, style:'width:100%;height:120px;object-fit:cover;border-radius:6px;margin-bottom:6px'});
            const cname = el('div',{},[]); cname.textContent = c.name;
            const crole = el('div',{class:'muted'},[]); crole.textContent = c.character || '';
            ci.appendChild(cimg);
            ci.appendChild(cname);
            ci.appendChild(crole);
            castList.appendChild(ci);
          });
        } else {
          castSection.style.display = 'none';
        }

        // more info
        moreEl.innerHTML = `
          Runtime: ${d.runtime ? d.runtime + ' min' : '—'}<br>
          Budget: ${d.budget ? '$' + d.budget.toLocaleString() : '—'} • Revenue: ${d.revenue ? '$' + d.revenue.toLocaleString() : '—'}<br>
          Languages: ${d.spoken_languages?.map(l=>l.english_name||l.name).join(', ') || '—'}
        `;

      } catch (err) {
        console.error(err);
        overviewEl.textContent = "Failed to load details: " + err.message;
      }
    }

    /******************************
     * Events & init
     ******************************/
    loadMoreBtn.addEventListener('click', () => {
      if (currentPage < totalPages) {
        fetchMovies(currentPage + 1);
      }
    });

    refreshBtn.addEventListener('click', () => {
      // reset and reload first pages
      movies = [];
      currentPage = 1;
      totalPages = 1;
      fetchMovies(1);
    });

    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const q = searchInput.value.trim();
        if (!q) {
          // empty -> reload popular
          movies = []; currentPage = 1; totalPages = 1;
          fetchMovies(1);
        } else {
          movies = []; renderGrid();
          searchMovies(q);
        }
      }
    });

    // initial load: fetch first 2 pages to show "all" feeling (adjust as needed)
    (async function init() {
      try {
        await fetchMovies(1);
        // prefetch page 2 to show more items (optional)
        if (totalPages >= 2) await fetchMovies(2);
      } catch (e) {
        console.error(e);
        alert("Initialization error: " + e.message);
      }
    })();
  </script>
</body>
</html>
